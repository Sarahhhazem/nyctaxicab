# Analysis of Factors Predicting NYC Taxi Cab Revenue and Accident Likelihood: Optimizing NYC Taxi Revenue

## Introduction
As of 2016, there are 143,674 for-hire vehicles licensed to operate in New York City by the Taxi & Limousine Commission; of those, nearly 14,000 are medallion taxicabs (classic “yellow” cabs) and almost 8,000 are boro taxis (“green” cabs). Large amounts of tourism in the city are lucrative for taxi drivers and their investment companies; November 2016 saw an average of 336,737 daily trips netting $4.98 million, a vital element of NYC revenue (TLC, 2016). Yet, drivers are faced with dropping average revenue due to the introduction of rideshare services in 2011. It is therefore vital for the TLC and taxicab owners to discover ways to optimize revenue and reduce costly accidents, so that owners can make sustainable wages and pay back taxicab medallion investments. One method of optimization is to explore predictive regression - if we can determine optimal conditions for drivers to receive the greatest tips, least risk, or largest demand, then we can reduce idle time and costs while maximizing business revenue. Our project focuses upon three major questions that can assist in business decisions: 
1.	Can we predict the ride tip based on external factors such as time of day, day of the week, weather, etc.? Determining this can help drivers know when to be most active for cost-benefit maximization.
2.	Can we predict which locations contain the most traffic for either pickups or drop offs, given a certain time of day or week? This can further allow drivers to be at the optimal locations for idle time reduction.
3.	Can we determine when accidents are more likely based on external factors such as time or weather? We can avoid congestion or damage to taxi cabs with this prediction.

## Method
Cleaning Procedure. The first step was to gather the data. The data was taken from NYC OpenData and the National Centers for Environmental Information: National Oceanic and Atmospheric Administration. We used data from 2018 so that we would have a full years worth of data in case there are possible trends by month. Another reason was due to the very large size of the Yellow Taxi Data file, which was a 10 GB file that we took every 6th row of to make smaller so that Python could process it (without doing this it caused memory errors for being too large). We felt that given such a large data set, this slightly smaller subset would still work since we took a good sampling from the data set and it remained very robust. 
The next step was cleaning the data. First, we cleaned the weather data. To do this, the weather from one station in NYC was taken. Then, the columns that we wanted to include (Date, Wind, Precipitation, Snow, and Temperature) were taken from the data set. The average temperature per day was calculated, any null dates were excluded, and dates were turned into datetime data types. Then, the crash data set was cleaned. First we selected only the dates from 2018, then we selected the relevant columns and again excluded any null values from the Borough, then converted the date to datetime data type. The taxizone data was also cleaned by dropping any null values and keeping only the LocationID and Borough. The taxi data itself was the largest file, and that was cleaned by selecting only the 2018 data, selecting the desired columns, dropping any null values for the necessary columns like pickup datetime and dropoff datetime, converting values to their proper data types, and then calculating the overall ride time. 

### Part 1: Regression on Tips. 
For the linear regression, the first step was to create the data set that we would be using. This was done by taking a smaller subset of the taxi data, since again there were memory issues due to the size of the file. Then, the taxi data was merged with the weather data so that linear regression could be run for all of these factors. The file was then exported as a CSV and run through R. Variables that were regressed upon were: amount of precipitation (whether it is rain or snow), average temperature of the day, average wind speed of the day, number of passengers in the ride, and total fare amount without tip. The dependent variable in the regression was the tip fare, received from the taxi data.

### Part 2: Location Hotspot Determination. 
By analyzing taxi ride hotspots, we would like to develop a strategy to maximize taxi drivers’ income from the dimension of time, pickup locations, potential amount of tips, and ride distances.  After plotting the maps, we can have a general picture of the distribution of events. If we assume the number of rides in the past is an indicator of its trend in the future, we will reach an optimal strategy to generate the most tips for taxi drivers by putting them into areas where there’s a larger probability of the most profitable rides. In other words, we want to find long-distance trips that take place in popular pickup locations with larger chances to get decent tips in the busiest area of the city at a specific time. 

### Part 3: Accident Prediction. 
First, we ran a k-nearest neighbors algorithm to predict the street where an accident is likely to occur based on the crash time, date, borough, number of people injured, and number of people killed.  We labeled encoded categorical features, split the data into train and test, and then trained the model on the train dataset and tested it on the test dataset. Second, the data set that was used was created. To do this, we changed crash time to simply show AM or PM, as well as finding the day of the week of the accident. Then, we merged the weather and crash data together and outputted the results into a CSV to be used in R. In R, we ran a simple linear regression. 

## Results
Results for the regressions and methods described above are displayed in the Appendix of this paper. Significant findings are described below. These results provide insight into what conditions or locations would be beneficial for drivers to be aware of, in order to maximize revenue with minimal time and resource waste.

### Outcome 1
When regressing over the variables precipitation, average temperature, average wind speed, number of passengers, and total tip-less fare, results show that all variables are statistically significant, the general regression F-statistic is significant, and RSE was 0.727 with adjusted R-squared of 0.472. Precipitation was slightly negatively correlated with tip amount, indicating that if there was rain or snow, passengers would actually tip slightly less. Temperature was the second-most effective variable on tip amount, with a positive correlation indicating that if the day were hotter, tips would increase. Wind speed and passenger count were both slightly negatively correlated with tips as well; a lower wind speed and a lower number of total passengers would independently predict a very slight tip increase. Finally, the total fare amount was greatly positively correlated with tips, which does make logical sense; passengers would usually tip more if the ride was longer and cost more. This regression provides insights as to what conditions are beneficial for drivers to potentially collect more tips. 

### Outcome 2
By looking at the heatmaps, we find that midtown and downtown Manhattan, Long Island City, Upper Brooklyn, and JFK are the busiest spots.  In addition, more rides departing from Manhattan and JFK have a 15% tip than rides from anywhere else. More interestingly, although midtown Manhattan has the most convenient public transportation network in the city, it still has more rides longer than 3 miles than other places. Therefore, after we look at the traffic at different time ranges, we come to a conclusion that midtown Manhattan is the place where taxi drivers can make more money for all time ranges.

### Outcome 3
For the k-nearest neighbors model built to predict the location of crash, we obtained an accuracy of approximately 0.008, regardless of the number of features used. With such a low accuracy, we decided against using the nearest neighbors model. The knn model is most likely inaccurate because it assumes that crash date and time can somehow predict the specific street where an accident occurs, when in reality, most of the accidents tend to happen at around the same time of day. Therefore, it’s not the best practice to predict accident location based on date and time. We looked at histograms to show the time of day at which accidents are more likely to occur for each borough and for each street. For boroughs, the histograms follow almost the same distribution. The distributions are, however, not as similar for streets, yet the differences are not significant enough to be used for prediction. We instead opted for a linear regression predicting the number of crashes in a day based on environmental and time-based factors. The time of day (whether it was day or night) and the borough  proved statistically insignificant, while variables for average wind speed, precipitation (rain amount), snow, temperature, and day of week were significant, with an overall F-statistic showing our model was significant. Greater amounts of wind and rain were correlated positively with the number of accidents, while temperature was correlated slightly positively as well. Interestingly, snow days proved unlikely to predict a greater number of accidents, and of the days of the week, every day except for Friday also showed as having a lesser likelihood for accidents. These results show when drivers could be more wary of accidents based on factors out of their control.
  
## Discussion
As taxi cab rides are facing direct competition from rideshare services in New York City, it is more imperative than ever to analyze past taxi data in order to protect cab revenue and ensure both taxi drivers and their backing investment companies remain profitable. Using regression and analysis, we were able to discover a multitude of factors that could allow drivers to either avoid regions with potential resource-wasting accidents, or optimize their schedules based on extenuating factors like weather, time, and location. Our first regression showed that factors like low precipitation, higher temperatures, lower wind speed, and fewer total passengers per ride were all correlated with a higher tip for the ride. This information allows drivers to, for example, choose to be more active on hotter days with less precipitation, in order to optimize revenue per ride beyond regular fare. The next analysis done concerned location of pickup - we discovered via mapping that Manhattan and JFK Airport were the most popular at all times and received better tips and longer distance rides, clearly indicating drivers should be most active in these regions no matter the time of day. Finally, our accident regression showed that accidents were more likely to occur given precipitation and high winds. Drivers knowing this information could avoid accidents or be more careful if such weather was happening, thus reducing costly accidents and resulting time and resource wastage. Unfortunately, our analysis of predicting which streets would be most dangerous given a certain time was inaccurate and could not be presented with confidence; in our next report, we would like to further explore factors that can reduce accidents and improve revenue per ride for taxis, with great implications for NYC business revenue as a whole.

## References
* Calgary, Open. “Accidents in NYC.” NYC Open Data, data.cityofnewyork.us/browse?q=Motor%2BVehicle%2BCollisions%2BSummary%2BReports&sortBy=relevance.
* Limousine Commission. “2018 Yellow Taxi Trip Data: NYC Open Data.” 2018 Yellow Taxi Trip Data, NYC Open Data, 5 Apr. 2019, data.cityofnewyork.us/Transportation/2018-Yellow-Taxi-Trip-Data/t29m-gskq.
* National Weather Service Corporate Image Web Team. “National Weather Service Climate.” National Weather Service, 24 Oct. 2005, w2.weather.gov/climate/xmacis.php?wfo=okx.
* “TLC Trip Record Data.” About TLC , TLC, www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page.


## Collaborators
* Sarah Hazem
* Alison Li
* Lei Li 
* Peter Liu
* Sona Thakur

